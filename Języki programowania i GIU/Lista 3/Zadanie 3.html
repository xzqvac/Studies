<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Saper</title>
    <style>
      table {
        text-align: center;
          margin: auto;
          position: relative;
      }
      td {
          width: 40px;
          height: 40px;
      }
      table, th, td {
          border: 1px solid black;
          border-collapse: collapse;
      }
      div {
          text-align: center;
          margin: 10px;
      }
      input {
          width: 80px;
      }
    </style>
</head>
<body>
  <table id="myTable">
  </table>
  <div>
      <p>Wymiary planszy: <input id="height" > x <input id="width"></p>
      <button onclick="startGame(0.05)" id="easy"> Łatwy </button>
      <button onclick="startGame(0.10)" id="medium"> Średni </button>
      <button onclick="startGame(0.20)" id="hard"> Trudny </button>
  </div>
  <script>
     function createBoard(height, width, ratio){
          let tableHTML = '';
          for(let i = 1; i <= height; i++){
              let tr = '<tr>';

              for(let j = 1; j <= width; j++){
                  tr += '<td>';
              }
              tr += '</tr>'
              tableHTML += tr;
          }
         document.getElementById('myTable').innerHTML = tableHTML;
         let array = [];
         let max = Math.floor(height * width);
         for(let x = 0; x < ratio * max; x++){
             let number = Math.floor(Math.random() * (max + 1));
             let check = array.includes(number);
             if(check === false)
                 array.push(number)
             else{
                 while(check === true){
                     number = Math.floor(Math.random() * (max + 1));
                     check = array.includes(number);
                     if(check === false){
                         array.push(number);
                     }
                 }
             }
         }
         return array;
     }

    function startGame(ratio){
        let mapHeight = document.getElementById('height').value;
        let mapWidth = document.getElementById('width').value;
        let array =  createBoard(mapHeight, mapWidth, ratio);
        let cells = document.querySelectorAll('td');
        console.log("DL",cells.length);

        array.forEach(number =>{
            cells[number].className = 'bomba';
        })

        let nonWinner = document.getElementsByClassName('bomba');

        cells.forEach(cell =>{
          cell.onclick = function checkBomb(){
              if (this.className === 'bomba'){
                  this.style.background = "red";
              }
              else
              {
                  --nonWinner;
                  if(nonWinner === 0)
                  {
                      console.log("Ile pozostalo:",nonWinner.length);
                      console.log("WYGRANA");
                  }
                  let nearBombs = 0;
                  let colIndex = this.cellIndex;
                  let rowIndex = this.parentNode.rowIndex;
                  let colLength = document.getElementById("myTable").rows[0].cells.length;
                  let rowLength = document.getElementById("myTable").rows.length;
                  let cellIndex = colIndex + rowLength * rowIndex;
                  if(colIndex === 0 && rowIndex === 0) // lewy gorny rog
                  {
                    if(cells[cellIndex + 1].className === 'bomba') nearBombs++;
                    if(cells[cellIndex + rowLength].className === 'bomba') nearBombs++;
                    if(cells[cellIndex + rowLength + 1].className === 'bomba')nearBombs++;
                  }
                  else if(colIndex === (rowLength - 1)  && rowIndex === 0) // prawy gorny rog
                  {
                      if(cells[cellIndex - 1].className === 'bomba') nearBombs++;
                      if(cells[cellIndex + rowLength].className === 'bomba') nearBombs++;
                      if(cells[cellIndex + rowLength - 1].className === 'bomba') nearBombs++;
                  }
                  else if(colIndex === 0 && rowIndex === (rowLength - 1))// lewy dolny rog
                  {
                      if(cells[cellIndex + 1].className === 'bomba') nearBombs++;
                      if(cells[cellIndex - rowLength].className === 'bomba') nearBombs++;
                      if(cells[cellIndex - rowLength + 1].className === 'bomba') nearBombs++;
                  }
                  else if(colIndex === (rowLength - 1) && rowIndex === (rowLength -1)) // Prawy dolny rog
                  {
                      if(cells[cellIndex - 1].className === 'bomba') nearBombs++;
                      if(cells[cellIndex - rowLength].className === 'bomba') nearBombs++;
                      if(cells[cellIndex - rowLength - 1].className === 'bomba') nearBombs++;
                  }
                  else if(rowIndex === 0) { //gora
                      if(cells[cellIndex - 1].className === 'bomba') nearBombs++;
                      if(cells[cellIndex + 1].className === 'bomba') nearBombs++;
                      if(cells[cellIndex + rowLength].className === 'bomba')nearBombs++;
                      if(cells[cellIndex + rowLength - 1].className === 'bomba') nearBombs++;
                      if(cells[cellIndex + rowLength + 1].className === 'bomba') nearBombs++;
                  }
                  else if(rowIndex === colLength - 1) { //dol
                      if(cells[cellIndex - 1].className === 'bomba') nearBombs++;
                      if(cells[cellIndex + 1].className === 'bomba') nearBombs++;
                      if(cells[cellIndex - rowLength].className === 'bomba') nearBombs++;
                      if(cells[cellIndex - rowLength - 1].className === 'bomba') nearBombs++;
                      if(cells[cellIndex - rowLength + 1].className === 'bomba') nearBombs++;
                  }
                  else if(colIndex === 0 && (rowLength - 2 > 1)) { //lewy pion
                      if(cells[cellIndex + 1].className === 'bomba') nearBombs++;
                      if(cells[cellIndex - rowLength].className === 'bomba') nearBombs++;
                      if(cells[cellIndex + rowLength].className === 'bomba') nearBombs++;
                      if(cells[cellIndex + rowLength + 1].className === 'bomba') nearBombs++;
                      if(cells[cellIndex - rowLength + 1].className === 'bomba') nearBombs++;
                  }
                  else if(colIndex === (rowLength - 1) && (rowLength - 2 > 1)) { //prawy pion
                      if(cells[cellIndex - 1].className === 'bomba') nearBombs++;
                      if(cells[cellIndex - rowLength].className === 'bomba') nearBombs++;
                      if(cells[cellIndex + rowLength].className === 'bomba') nearBombs++;
                      if(cells[cellIndex + rowLength - 1].className === 'bomba') nearBombs++;
                      if(cells[cellIndex - rowLength - 1].className === 'bomba') nearBombs++;
                  }

                  else { //Wewnętrzny kwadrat
                      if (cells[cellIndex - 1].className === 'bomba') nearBombs++;
                      if (cells[cellIndex + 1].className === 'bomba') nearBombs++;
                      if (cells[cellIndex - rowLength].className === 'bomba') nearBombs++;
                      if (cells[cellIndex + rowLength].className === 'bomba') nearBombs++;
                      if (cells[cellIndex - rowLength - 1].className === 'bomba') nearBombs++;
                      if (cells[cellIndex - rowLength + 1].className === 'bomba') nearBombs++;
                      if (cells[cellIndex + rowLength - 1].className === 'bomba') nearBombs++;
                      if (cells[cellIndex + rowLength + 1].className === 'bomba') nearBombs++;
                  }
                  this.innerText = nearBombs;
              }
          }
        })
    }
  </script>
</body>
</html>